define("mod_rplace/rplace",["exports","core/ajax","core/pubsub","tool_realtime/events","core/notification"],(function(_exports,Ajax,PubSub,RealTimeEvents,Notification){function _getRequireWildcardCache(nodeInterop){if("function"!=typeof WeakMap)return null;var cacheBabelInterop=new WeakMap,cacheNodeInterop=new WeakMap;return(_getRequireWildcardCache=function(nodeInterop){return nodeInterop?cacheNodeInterop:cacheBabelInterop})(nodeInterop)}function _interopRequireWildcard(obj,nodeInterop){if(!nodeInterop&&obj&&obj.__esModule)return obj;if(null===obj||"object"!=typeof obj&&"function"!=typeof obj)return{default:obj};var cache=_getRequireWildcardCache(nodeInterop);if(cache&&cache.has(obj))return cache.get(obj);var newObj={},hasPropertyDescriptor=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var key in obj)if("default"!==key&&Object.prototype.hasOwnProperty.call(obj,key)){var desc=hasPropertyDescriptor?Object.getOwnPropertyDescriptor(obj,key):null;desc&&(desc.get||desc.set)?Object.defineProperty(newObj,key,desc):newObj[key]=obj[key]}return newObj.default=obj,cache&&cache.set(obj,newObj),newObj}
/**
   * Allows to draw pattern
   *
   * @module     mod_rplace/rplace
   * @copyright  2024 Marina Glancy
   * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
   */Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.init=void 0,Ajax=_interopRequireWildcard(Ajax),PubSub=_interopRequireWildcard(PubSub),RealTimeEvents=_interopRequireWildcard(RealTimeEvents),Notification=_interopRequireWildcard(Notification);const SELECTORS_PATTERNTABLE=".mod_rplace_pattern",SELECTORS_PATTERNTD=".mod_rplace_pattern td",SELECTORS_CLICKABLEPATTERNTD=".mod_rplace_pattern.clickable td",SELECTORS_CHOOSERTD=".mod_rplace_chooser td",SELECTORS_CLICKABLECHOOSERTD=".mod_rplace_chooser.clickable td";let colors=["#ffffff"],currentColor=2;const setBgColor=(el,colorId)=>{let style="background-color: "+colors[colorId];"#000000"===colors[colorId]&&(style+="; color: #ffffff"),el.style=style},redraw=pattern=>{const patternrows=(""+pattern).split(/\n/);document.querySelectorAll(SELECTORS_PATTERNTD).forEach((el=>{var _patternrows$y;const x=parseInt(el.dataset.x),y=parseInt(el.dataset.y);let value=(null!==(_patternrows$y=patternrows[y])&&void 0!==_patternrows$y?_patternrows$y:"").charCodeAt(x);value=(isNaN(value)?48:value)-48,setBgColor(el,value)}))},setCurrentColor=colorId=>{document.querySelectorAll(SELECTORS_CLICKABLECHOOSERTD).forEach((el=>{const id=parseInt(el.dataset.id);el.innerHTML=id===colorId?"X":"&nbsp;"})),currentColor=colorId};_exports.init=(cmid,colorset)=>{colors=colorset,setCurrentColor(Math.floor(Math.random()*colors.length));const patternTable=document.querySelector(SELECTORS_PATTERNTABLE);if(!patternTable)return;const initalpattern=patternTable.dataset.pattern;redraw(initalpattern),document.querySelectorAll(SELECTORS_CHOOSERTD).forEach((el=>{setBgColor(el,parseInt(el.dataset.id))})),document.querySelectorAll(SELECTORS_CLICKABLEPATTERNTD).forEach((el=>{el.addEventListener("click",(e=>{e.preventDefault(),el.style="background-color: "+colors[currentColor],Ajax.call([{methodname:"mod_rplace_paint",args:{cmid:parseInt(cmid),x:parseInt(el.dataset.x),y:parseInt(el.dataset.y),color:currentColor}}])}))})),document.querySelectorAll(SELECTORS_CLICKABLECHOOSERTD).forEach((el=>{el.addEventListener("click",(e=>{e.preventDefault(),setCurrentColor(parseInt(el.dataset.id))}))})),PubSub.subscribe(RealTimeEvents.CONNECTION_LOST,(e=>{window.console.log("Error",e),Notification.exception({name:"Error",message:"Something went wrong, please refresh the page"})})),PubSub.subscribe(RealTimeEvents.EVENT,(function(eventData){var _eventData$context;const data=null!=eventData&&null!==(_eventData$context=eventData.context)&&void 0!==_eventData$context&&_eventData$context.component?eventData.context:eventData;if(!data.payload||"mod_rplace"!=data.component||"pattern"!=data.area||data.itemid!=cmid)return;const updates=data.payload.updates,el=updates?document.querySelector(SELECTORS_CLICKABLEPATTERNTD+'[data-x="'.concat(updates.x,'"][data-y="').concat(updates.y,'"]')):null;if(el)setBgColor(el,updates.color);else{const pattern=data.payload.pattern;pattern&&redraw(pattern)}}))}}));

//# sourceMappingURL=rplace.min.js.map